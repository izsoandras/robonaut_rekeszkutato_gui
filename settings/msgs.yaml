### MQTT topics and message types
# <topic_name>:
#   <message_name>:
#     type: <type_byte>
#     format: '<message_fields_format_string>' # https://docs.python.org/3/library/struct.html
#     names: [<field_names>, ...]
#   [...]
# [...]


#- name: log
#  messages:
#    - name: log
#      type: 0x00
#      format: 'Bs'
#      fields: [level, msg]
#      prefixes: [INFO, ERR, WARN]
#
#- name: tel
#  messages:
#    - name: batt
#      type: 0x01
#      format: '>HH'
#      fields: [aux, mot]
#      factors: [0.0045934065934066, 0.0045934065934066] # [209/45500, 209/45500]
#
#    - name: front_line
#      type: 0x02
#      format: '>IBfff'
#      fields: [detect, num, pos1, pos2, pos3]
#
#    - name: back_line
#      type: 0x03
#      format: '>IBfff'
#      fields: [ detect, num, pos1, pos2, pos3 ]
#
#    - name: speed
#      type: 0x04
#      format: '>HffffII'
#      fields: [duty, current, current_setp, speed, speed_setp, distance, distance_setp]
#
#    - name: imu
#      type: 0x0E
#      format: '>ff'
#      fields: [heading, heading_setp]
#
#- name: param
#  messages:
#    - name: servo_cal
#      type: 0x06
#      format: '>HHHH'
#      fields: [center1, center2, delta1, delta2]
#    - name: current_setp
#      type: 0x07
#      format: 'f'
#      fields: [current_setp]
#    - name: speed_setp
#      type: 0x08
#      format: 'f'
#      fields: [speed_setp]
#    - name: line_param
#      type: 0x09
#      format: 'fff'
#      fields: [kszi, d0, dv]
#    - name: start
#      type: 0x0A
#      format: ''
#      fields: []
#    - name: stop
#      type: 0x0B
#      format: ''
#      fields: []
#    - name: gate
#      type: 0x0C
#      format: 'c'
#      fields: [gate]
#
- name: log
  messages:
    - name: log
      type: 0x00
      format: 'Bs'
      fields: [level, msg]
      prefixes: [INFO, ERR, WARN]

- name: tel
  messages:
    - name: battery
      type: 0x01
      format: 'f'
      fields: [batt]

    - name: speed
      type: 0xA1
      format: '<ff'
      fields: [duty, w]

    - name: distance
      type: 0xA3
      format: '<H'
      fields: [dist]

    - name: mot1_speed
      type: 0xA5
      format: '<ff'
      fields: [speed, setpoint]

    - name: mot2_speed
      type: 0xA6
      format: '<ff'
      fields: [ speed, setpoint ]

    - name: mot3_speed
      type: 0xA7
      format: '<ff'
      fields: [ speed, setpoint ]

    - name: imu_mag
      type: 0x90
      format: '<fff'
      fields: [X, Y, Z]

    - name: imu_acc
      type: 0x91
      format: '<fff'
      fields: [ X, Y, Z ]

    - name: imu_gyro
      type: 0x92
      format: '<fff'
      fields: [ X, Y, Z ]


    - name: x_pos
      type: 0x80
      format: '<ff'
      fields: [x_curr, x_setp]

    - name: y_pos
      type: 0x81
      format: '<ff'
      fields: [ y_curr, y_setp ]

    - name: head
      type: 0x82
      format: '<ff'
      fields: [ h_curr, h_setp ]

    - name: control_vec
      type: 0x83
      format: '<fff'
      fields: [gang, ang, magn]

    - name: state_vec
      type: 0x84
      format: '<ffffff'
      fields: [ x_pos, y_pos, head, x_pos_setp, y_pos_setp, head_setp ]

- name: param
  messages:
    - name: wheel_setp
      type: 0xA4
      format: '<fff'
      fields: [mot1, mot2, mot3]
    - name: ident_duty
      type: 0xA8
      format: '<f'
      fields: ['duty']

    - name: Robot control vec
      type: 0xA9
      format: '<fff'
      fields: [V_x, V_y, w]

    - name: Ref state
      type: 0x94
      format: '<fff'
      fields: [x_pos, y_pos, head]